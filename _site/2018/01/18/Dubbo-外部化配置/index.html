<h1 id="dubbo-外部化配置externalized-configuration">Dubbo 外部化配置（Externalized Configuration）</h1>

<h2 id="主目录"><a href="Dubbo-New-Programming-Model.md">主目录</a></h2>

<h2 id="外部化配置external-configuration">外部化配置（External Configuration）</h2>

<p>在<a href="Dubbo-Annotation-Driven.md">Dubbo 注解驱动</a>例子中，无论是服务提供方，还是服务消费方，均需要转配相关配置Bean：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">ApplicationConfig</span> <span class="nf">applicationConfig</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">ApplicationConfig</span> <span class="n">applicationConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ApplicationConfig</span><span class="o">();</span>
        <span class="n">applicationConfig</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"dubbo-annotation-consumer"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">applicationConfig</span><span class="o">;</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>虽然实现类似于<code class="highlighter-rouge">ProviderConfiguration</code> 和 <code class="highlighter-rouge">ConsumerConfiguration</code> 这样的 Spring  <code class="highlighter-rouge">@Configuration</code> Bean 成本并不高，不过通过 Java Code 的方式定义配置 Bean，或多或少是一种 Hard Code（硬编码）的行为，缺少弹性。</p>

<p>尽管在 Spring 应用中，可以通过 <code class="highlighter-rouge">@Value</code> 或者 <code class="highlighter-rouge">Environment</code> 的方式获取外部配置，其代码简洁性以及类型转换灵活性存在明显的不足。因此，Spring Boot  提出了外部化配置（External Configuration）的感念，即通过程序以外的配置源，动态地绑定指定类型。</p>

<p>随着 Spring Boot / Spring Cloud 应用的流行，开发人员逐渐地接受并且使用 Spring Boot 外部化配置（External Configuration），即通过 <code class="highlighter-rouge">application.properties</code> 或者 <code class="highlighter-rouge">bootstrap.properties</code> 装配配置 Bean。</p>

<p>下列表格记录了 Dubbo 内置配置类：</p>

<table>
  <thead>
    <tr>
      <th>配置类</th>
      <th>标签</th>
      <th>用途</th>
      <th>解释</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">ProtocolConfig</code></td>
      <td><code class="highlighter-rouge">&lt;dubbo:protocol/&gt;</code></td>
      <td>协议配置</td>
      <td>用于配置提供服务的协议信息，协议由提供方指定，消费方被动接受</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">ApplicationConfig</code></td>
      <td><code class="highlighter-rouge">&lt;dubbo:application/&gt;</code></td>
      <td>应用配置</td>
      <td>用于配置当前应用信息，不管该应用是提供者还是消费者</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">ModuleConfig</code></td>
      <td><code class="highlighter-rouge">&lt;dubbo:module/&gt;</code></td>
      <td>模块配置</td>
      <td>用于配置当前模块信息，可选</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">RegistryConfig</code></td>
      <td><code class="highlighter-rouge">&lt;dubbo:registry/&gt;</code></td>
      <td>注册中心配置</td>
      <td>用于配置连接注册中心相关信息</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">MonitorConfig</code></td>
      <td><code class="highlighter-rouge">&lt;dubbo:monitor/&gt;</code></td>
      <td>监控中心配置</td>
      <td>用于配置连接监控中心相关信息，可选</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">ProviderConfig</code></td>
      <td><code class="highlighter-rouge">&lt;dubbo:provider/&gt;</code></td>
      <td>提供方配置</td>
      <td>当 ProtocolConfig 和 ServiceConfig 某属性没有配置时，采用此缺省值，可选</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">ConsumerConfig</code></td>
      <td><code class="highlighter-rouge">&lt;dubbo:consumer/&gt;</code></td>
      <td>消费方配置</td>
      <td>当 ReferenceConfig 某属性没有配置时，采用此缺省值，可选</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">MethodConfig</code></td>
      <td><code class="highlighter-rouge">&lt;dubbo:method/&gt;</code></td>
      <td>方法配置</td>
      <td>用于 ServiceConfig 和 ReferenceConfig 指定方法级的配置信息</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">ArgumentConfig</code></td>
      <td><code class="highlighter-rouge">&lt;dubbo:argument/&gt;</code></td>
      <td>参数配置</td>
      <td>用于指定方法参数配置</td>
    </tr>
  </tbody>
</table>

<p>通过申明对应的 Spring 扩展标签，在 Spring 应用上下文中将自动生成相应的配置 Bean。</p>

<p>在 Dubbo 官方用户手册的<a href="http://dubbo.io/books/dubbo-user-book/configuration/properties.html">“属性配置”</a>章节中，<code class="highlighter-rouge">dubbo.properties</code> 配置属性能够映射到  <code class="highlighter-rouge">ApplicationConfig</code> 、<code class="highlighter-rouge">ProtocolConfig</code> 以及 <code class="highlighter-rouge">RegistryConfig</code> 的字段。从某种意义上来说，<code class="highlighter-rouge">dubbo.properties</code>  也是 Dubbo 的外部化配置。</p>

<p>其中，引用“映射规则”的内容：</p>

<blockquote>
  <h2 id="映射规则">映射规则</h2>

  <p>将 XML 配置的标签名，加属性名，用点分隔，多个属性拆成多行</p>

  <ul>
    <li>比如：<code class="highlighter-rouge">dubbo.application.name=foo</code>等价于<code class="highlighter-rouge">&lt;dubbo:application name="foo" /&gt;</code></li>
    <li>比如：<code class="highlighter-rouge">dubbo.registry.address=10.20.153.10:9090</code>等价于<code class="highlighter-rouge">&lt;dubbo:registryaddress="10.20.153.10:9090" /&gt;</code></li>
  </ul>

  <p>如果 XML 有多行同名标签配置，可用 id 号区分，如果没有 id 号将对所有同名标签生效</p>

  <ul>
    <li>比如：<code class="highlighter-rouge">dubbo.protocol.rmi.port=1234</code>等价于<code class="highlighter-rouge">&lt;dubbo:protocol id="rmi" name="rmi" port="1099" /&gt;</code><a href="http://dubbo.io/books/dubbo-user-book/configuration/properties.html#fn_2">2</a></li>
    <li>比如：<code class="highlighter-rouge">dubbo.registry.china.address=10.20.153.10:9090</code>等价于<code class="highlighter-rouge">&lt;dubbo:registry id="china"address="10.20.153.10:9090" /&gt;</code></li>
  </ul>

  <p>下面是 dubbo.properties 的一个典型配置：</p>

  <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>dubbo.application.name=foo
dubbo.application.owner=bar
dubbo.registry.address=10.20.153.10:9090
</pre></td></tr></tbody></table></code></pre></div>  </div>
</blockquote>

<p>根据“映射规则”，Dubbo 即支持单配置 Bean 映射，也支持多 Bean 映射。综合以上需求，既要兼容 Dubbo 已有的一个或多个 Bean 字段映射绑定，也支持外部化配置。</p>

<blockquote>
  <p>特别提醒：外部化配置（External Configuration）并非 Spring Boot 特有，即使在 Spring Framework 场景下亦能支持。也就是说 Dubbo 外部化配置即可在 Spring Framework 中工作，也能在 Spring Boot 中运行。</p>
</blockquote>

<p>Dubbo 外部化配置（External Configuration） 支持起始版本为：<code class="highlighter-rouge">2.5.8</code></p>

<h3 id="enabledubboconfig"><code class="highlighter-rouge">@EnableDubboConfig</code></h3>

<h4 id="起始版本258">起始版本：<code class="highlighter-rouge">2.5.8</code></h4>

<h4 id="使用说明">使用说明</h4>

<h5 id="enabledubboconfig-定义"><code class="highlighter-rouge">@EnableDubboConfig</code> 定义</h5>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="nd">@interface</span> <span class="n">EnableDubboConfig</span> <span class="o">{</span>

    <span class="cm">/**
     * It indicates whether binding to multiple Spring Beans.
     *
     * @return the default value is &lt;code&gt;false&lt;/code&gt;
     * @revised 2.5.9
     */</span>
    <span class="kt">boolean</span> <span class="nf">multiple</span><span class="o">()</span> <span class="k">default</span> <span class="kc">false</span><span class="o">;</span>

<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li><code class="highlighter-rouge">multiple</code> : 表示是否支持多Dubbo 配置 Bean 绑定。默认值为 <code class="highlighter-rouge">false</code> ，即单 Dubbo 配置 Bean 绑定</li>
</ul>

<h5 id="单-dubbo-配置-bean-绑定">单 Dubbo 配置 Bean 绑定</h5>

<p>为了更好地向下兼容，<code class="highlighter-rouge">@EnableDubboConfig</code> 提供外部化配置属性与 Dubbo 配置类之间的绑定，其中映射关系如下：</p>

<table>
  <thead>
    <tr>
      <th>配置类</th>
      <th>外部化配置属性前缀</th>
      <th>用途</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">ProtocolConfig</code></td>
      <td><code class="highlighter-rouge">dubbo.protocol</code></td>
      <td>协议配置</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">ApplicationConfig</code></td>
      <td><code class="highlighter-rouge">dubbo.application</code></td>
      <td>应用配置</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">ModuleConfig</code></td>
      <td><code class="highlighter-rouge">dubbo.module</code></td>
      <td>模块配置</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">RegistryConfig</code></td>
      <td><code class="highlighter-rouge">dubbo.registry</code></td>
      <td>注册中心配置</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">MonitorConfig</code></td>
      <td><code class="highlighter-rouge">dubbo.monitor</code></td>
      <td>监控中心配置</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">ProviderConfig</code></td>
      <td><code class="highlighter-rouge">dubbo.provider</code></td>
      <td>提供方配置</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">ConsumerConfig</code></td>
      <td><code class="highlighter-rouge">dubbo.consumer</code></td>
      <td>消费方配置</td>
    </tr>
  </tbody>
</table>

<p>当标注 <code class="highlighter-rouge">@EnableDubboConfig</code> 的类被扫描注册后，同时  Spring（Spring Boot）应用配置（<code class="highlighter-rouge">PropertySources</code>）中存在<code class="highlighter-rouge">dubbo.application.*</code> 时，<code class="highlighter-rouge">ApplicationConfig</code>  Bean 将被注册到在 Spring 上下文。否则，不会被注册。如果出现<code class="highlighter-rouge">dubbo.registry.*</code>的配置，那么，<code class="highlighter-rouge">RegistryConfig</code> Bean 将会创建，以此类推。即按需装配 Dubbo 配置 Bean。</p>

<p>如果需要指定配置 Bean的 id，可通过<code class="highlighter-rouge">**.id</code> 属性设置，以<code class="highlighter-rouge">dubbo.application</code> 为例：</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c">## application
</span><span class="py">dubbo.application.id</span> <span class="p">=</span> <span class="s">applicationBean</span>
<span class="py">dubbo.application.name</span> <span class="p">=</span> <span class="s">dubbo-demo-application</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>以上配置等同于以下 Java Config Bean：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>    <span class="nd">@Bean</span><span class="o">(</span><span class="s">"applicationBean"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">ApplicationConfig</span> <span class="nf">applicationBean</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">ApplicationConfig</span> <span class="n">applicationConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ApplicationConfig</span><span class="o">();</span>
        <span class="n">applicationConfig</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"dubbo-demo-application"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">applicationConfig</span><span class="o">;</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>大致上配置属性与配置类绑定模式 - <code class="highlighter-rouge">dubbo.application.* </code> 映射到 <code class="highlighter-rouge">ApplicationConfig</code> 中的字段。</p>

<blockquote>
  <p>注：当配置属性名称无法在配置类中找到字段时，将会忽略绑定</p>
</blockquote>

<h5 id="多-dubbo-配置-bean-绑定">多 Dubbo 配置 Bean 绑定</h5>

<p>Dubbo <code class="highlighter-rouge">@Service</code> 和 <code class="highlighter-rouge">@Reference</code> 允许 Dubbo 应用关联<code class="highlighter-rouge">ApplicationConfig</code> Bean 或者指定多个<code class="highlighter-rouge">RegistryConfig</code> Bean 等能力。换句话说，Dubbo 应用上下文中可能存在多个<code class="highlighter-rouge">ApplicationConfig</code> 等 Bean定义。</p>

<p>为了适应以上需要，因此从Dubbo <code class="highlighter-rouge">2.5.9</code> 开始，<code class="highlighter-rouge">@EnableDubboConfig</code> 支持多 Dubbo 配置 Bean 绑定，同时按照业界规约标准，与单 Dubbo 配置 Bean 绑定约定不同，配置属性前缀均为英文复数形式：</p>

<blockquote>
  <p>详情请参考 ：https://github.com/alibaba/dubbo/issues/1141</p>
</blockquote>

<ul>
  <li><code class="highlighter-rouge">dubbo.applications</code></li>
  <li><code class="highlighter-rouge">dubbo.modules</code></li>
  <li><code class="highlighter-rouge">dubbo.registries</code></li>
  <li><code class="highlighter-rouge">dubbo.protocols</code></li>
  <li><code class="highlighter-rouge">dubbo.monitors</code></li>
  <li><code class="highlighter-rouge">dubbo.providers</code></li>
  <li><code class="highlighter-rouge">dubbo.consumers</code></li>
</ul>

<p>以<code class="highlighter-rouge">dubbo.applications</code> 为例，基本的模式如下：</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="err">dubbo.applications.${bean-name}</span><span class="py">.property-name</span> <span class="p">=</span> <span class="s">${property-value}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>请读者注意，在单 Dubbo 配置 Bean 绑定时，可以通过指定<code class="highlighter-rouge">id</code> 属性的方式，定义<code class="highlighter-rouge">ApplicationConfig</code> Bean 的ID，即<code class="highlighter-rouge">dubbo.application.id</code>。</p>

<p>而在多 Dubbo 配置 Bean 绑定时，Bean ID 则由<code class="highlighter-rouge">dubbo.applications.</code>与属性字段名称（<code class="highlighter-rouge">.property-name</code>)之间的字符来表达。</p>

<p>如下配置：</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="c"># multiple Bean definition
</span><span class="py">dubbo.applications.applicationBean.name</span> <span class="p">=</span> <span class="s">dubbo-demo-application</span>
<span class="py">dubbo.applications.applicationBean2.name</span> <span class="p">=</span> <span class="s">dubbo-demo-application2</span>
<span class="py">dubbo.applications.applicationBean3.name</span> <span class="p">=</span> <span class="s">dubbo-demo-application3</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>该配置内容中，绑定了三个<code class="highlighter-rouge">ApplicationConfig</code> Bean，分别是<code class="highlighter-rouge">applicationBean</code>、<code class="highlighter-rouge">applicationBean2</code>以及<code class="highlighter-rouge">applicationBean3</code></p>

<h4 id="示例说明">示例说明</h4>

<p><code class="highlighter-rouge">@EnableDubboConfig</code> 的使用方法很简答， 再次强调一点，当规约的外部配置存在时，相应的 Dubbo 配置类 才会提升为 Spring Bean。简言之，按需装配。</p>

<h5 id="单-dubbo-配置-bean-绑定-1">单 Dubbo 配置 Bean 绑定</h5>

<h6 id="外部化配置文件">外部化配置文件</h6>

<p>将以下内容的外部化配置文件物理路径为：<code class="highlighter-rouge">classpath:/META-INF/config.properties</code>:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre><span class="c"># 单 Dubbo 配置 Bean 绑定
## application
</span><span class="py">dubbo.application.id</span> <span class="p">=</span> <span class="s">applicationBean</span>
<span class="py">dubbo.application.name</span> <span class="p">=</span> <span class="s">dubbo-demo-application</span>

<span class="c">## module
</span><span class="py">dubbo.module.id</span> <span class="p">=</span> <span class="s">moduleBean</span>
<span class="py">dubbo.module.name</span> <span class="p">=</span> <span class="s">dubbo-demo-module</span>

<span class="c">## registry
</span><span class="py">dubbo.registry.address</span> <span class="p">=</span> <span class="s">zookeeper://192.168.99.100:32770</span>

<span class="c">## protocol
</span><span class="py">dubbo.protocol.name</span> <span class="p">=</span> <span class="s">dubbo</span>
<span class="py">dubbo.protocol.port</span> <span class="p">=</span> <span class="s">20880</span>

<span class="c">## monitor
</span><span class="py">dubbo.monitor.address</span> <span class="p">=</span> <span class="s">zookeeper://127.0.0.1:32770</span>

<span class="c">## provider
</span><span class="py">dubbo.provider.host</span> <span class="p">=</span> <span class="s">127.0.0.1</span>

<span class="c">## consumer
</span><span class="py">dubbo.consumer.client</span> <span class="p">=</span> <span class="s">netty</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h6 id="enabledubboconfig-配置-bean"><code class="highlighter-rouge">@EnableDubboConfig</code> 配置 Bean</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="cm">/**
 * Dubbo 配置 Bean
 *
 * @author &lt;a href="mailto:mercyblitz@gmail.com"&gt;Mercy&lt;/a&gt;
 */</span>
<span class="nd">@EnableDubboConfig</span>
<span class="nd">@PropertySource</span><span class="o">(</span><span class="s">"META-INF/config.properties"</span><span class="o">)</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DubboConfiguration</span> <span class="o">{</span>

<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h6 id="实现引导类">实现引导类</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre></td><td class="rouge-code"><pre><span class="cm">/**
 * Dubbo 配置引导类
 *
 * @author &lt;a href="mailto:mercyblitz@gmail.com"&gt;Mercy&lt;/a&gt;
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DubboConfigurationBootstrap</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 创建配置上下文</span>
        <span class="n">AnnotationConfigApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="o">();</span>
        <span class="c1">// 注册当前配置 Bean</span>
        <span class="n">context</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">DubboConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">context</span><span class="o">.</span><span class="na">refresh</span><span class="o">();</span>
 	    <span class="c1">// application</span>
        <span class="n">ApplicationConfig</span> <span class="n">applicationConfig</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"applicationBean"</span><span class="o">,</span> <span class="n">ApplicationConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"applicationBean.name = %s \n"</span><span class="o">,</span> <span class="n">applicationConfig</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>

        <span class="c1">// module</span>
        <span class="n">ModuleConfig</span> <span class="n">moduleConfig</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"moduleBean"</span><span class="o">,</span> <span class="n">ModuleConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"moduleBean.name = %s \n"</span><span class="o">,</span> <span class="n">moduleConfig</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>

        <span class="c1">// registry</span>
        <span class="n">RegistryConfig</span> <span class="n">registryConfig</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">RegistryConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"registryConfig.name = %s \n"</span><span class="o">,</span> <span class="n">registryConfig</span><span class="o">.</span><span class="na">getAddress</span><span class="o">());</span>

        <span class="c1">// protocol</span>
        <span class="n">ProtocolConfig</span> <span class="n">protocolConfig</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">ProtocolConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"protocolConfig.name = %s \n"</span><span class="o">,</span> <span class="n">protocolConfig</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"protocolConfig.port = %s \n"</span><span class="o">,</span> <span class="n">protocolConfig</span><span class="o">.</span><span class="na">getPort</span><span class="o">());</span>

        <span class="c1">// monitor</span>
        <span class="n">MonitorConfig</span> <span class="n">monitorConfig</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">MonitorConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"monitorConfig.name = %s \n"</span><span class="o">,</span> <span class="n">monitorConfig</span><span class="o">.</span><span class="na">getAddress</span><span class="o">());</span>

        <span class="c1">// provider</span>
        <span class="n">ProviderConfig</span> <span class="n">providerConfig</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">ProviderConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"providerConfig.name = %s \n"</span><span class="o">,</span> <span class="n">providerConfig</span><span class="o">.</span><span class="na">getHost</span><span class="o">());</span>

        <span class="c1">// consumer</span>
        <span class="n">ConsumerConfig</span> <span class="n">consumerConfig</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">ConsumerConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"consumerConfig.name = %s \n"</span><span class="o">,</span> <span class="n">consumerConfig</span><span class="o">.</span><span class="na">getClient</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h6 id="执行结果">执行结果</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>applicationBean.name = dubbo-demo-application 
moduleBean.name = dubbo-demo-module 
registryConfig.name = zookeeper://192.168.99.100:32770 
protocolConfig.name = dubbo 
protocolConfig.port = 20880 
monitorConfig.name = zookeeper://127.0.0.1:32770 
providerConfig.name = 127.0.0.1 
consumerConfig.name = netty 
</pre></td></tr></tbody></table></code></pre></div></div>

<p>不难发现，<code class="highlighter-rouge">@EnableDubboConfig</code> 配置 Bean 配合外部化文件 <code class="highlighter-rouge">classpath:/META-INF/config.properties</code>，与执行输出内容相同。</p>

<h5 id="多-dubbo-配置-bean-绑定-1">多 Dubbo 配置 Bean 绑定</h5>

<h6 id="外部化配置文件-1">外部化配置文件</h6>

<p>将以下内容的外部化配置文件物理路径为：<code class="highlighter-rouge">classpath:/META-INF/multiple-config.properties</code>:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c"># 多 Dubbo 配置 Bean 绑定
## dubbo.applications
</span><span class="py">dubbo.applications.applicationBean.name</span> <span class="p">=</span> <span class="s">dubbo-demo-application</span>
<span class="py">dubbo.applications.applicationBean2.name</span> <span class="p">=</span> <span class="s">dubbo-demo-application2</span>
<span class="py">dubbo.applications.applicationBean3.name</span> <span class="p">=</span> <span class="s">dubbo-demo-application3</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h6 id="enabledubboconfig--配置-bean多"><code class="highlighter-rouge">@EnableDubboConfig</code>  配置 Bean（多）</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nd">@EnableDubboConfig</span><span class="o">(</span><span class="n">multiple</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="nd">@PropertySource</span><span class="o">(</span><span class="s">"META-INF/multiple-config.properties"</span><span class="o">)</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">DubboMultipleConfiguration</span> <span class="o">{</span>

<span class="o">}</span>	
</pre></td></tr></tbody></table></code></pre></div></div>

<h6 id="实现引导类-1">实现引导类</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="cm">/**
 * Dubbo 配置引导类
 *
 * @author &lt;a href="mailto:mercyblitz@gmail.com"&gt;Mercy&lt;/a&gt;
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DubboConfigurationBootstrap</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 创建配置上下文</span>
        <span class="n">AnnotationConfigApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="o">();</span>
        <span class="c1">// 注册当前配置 Bean</span>
        <span class="n">context</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">DubboMultipleConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">context</span><span class="o">.</span><span class="na">refresh</span><span class="o">();</span>

        <span class="c1">// 获取 ApplicationConfig Bean："applicationBean"、"applicationBean2" 和 "applicationBean3"</span>
        <span class="n">ApplicationConfig</span> <span class="n">applicationBean</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"applicationBean"</span><span class="o">,</span> <span class="n">ApplicationConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">ApplicationConfig</span> <span class="n">applicationBean2</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"applicationBean2"</span><span class="o">,</span> <span class="n">ApplicationConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">ApplicationConfig</span> <span class="n">applicationBean3</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"applicationBean3"</span><span class="o">,</span> <span class="n">ApplicationConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"applicationBean.name = %s \n"</span><span class="o">,</span> <span class="n">applicationBean</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"applicationBean2.name = %s \n"</span><span class="o">,</span> <span class="n">applicationBean2</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"applicationBean3.name = %s \n"</span><span class="o">,</span> <span class="n">applicationBean3</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h6 id="执行结果-1">执行结果</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>applicationBean.name = dubbo-demo-application 
applicationBean2.name = dubbo-demo-application2 
applicationBean3.name = dubbo-demo-application3 
</pre></td></tr></tbody></table></code></pre></div></div>

<p><code class="highlighter-rouge">@EnableDubboConfig(multiple = true)</code> 执行后，运行结果说明<code class="highlighter-rouge">ApplicationConfig</code> Bean 以及 ID 的定义方式。</p>

<h3 id="enabledubboconfigbinding--enabledubboconfigbindings"><code class="highlighter-rouge">@EnableDubboConfigBinding</code> &amp; <code class="highlighter-rouge">@EnableDubboConfigBindings</code></h3>

<p><code class="highlighter-rouge">@EnableDubboConfig</code>适合绝大多数外部化配置场景，然而无论是单 Bean 绑定，还是多 Bean 绑定，其<strong>外部化配置属性前缀</strong>是固化的，如<code class="highlighter-rouge">dubbo.application</code> 以及 <code class="highlighter-rouge">dubbo.applications</code> 。</p>

<p>当应用需要自定义<strong>外部化配置属性前缀</strong>，<code class="highlighter-rouge">@EnableDubboConfigBinding</code>能提供更大的弹性，支持单个外部化配置属性前缀（<code class="highlighter-rouge">prefix</code>) 与 Dubbo 配置 Bean 类型（<code class="highlighter-rouge">AbstractConfig</code> 子类）绑定，如果需要多次绑定时，可使用<code class="highlighter-rouge">@EnableDubboConfigBindings</code>。</p>

<blockquote>
  <p>尽管 Dubbo 推荐使用 Java 8 ，然而实际的情况，运行时的 JDK 的版本可能从 6到8 均有。因此，<code class="highlighter-rouge">@EnableDubboConfigBinding</code> 没有实现<code class="highlighter-rouge">java.lang.annotation.Repeatable</code>，即允许实现类不支持重复标注<code class="highlighter-rouge">@EnableDubboConfigBinding</code>。</p>
</blockquote>

<p><code class="highlighter-rouge">@EnableDubboConfigBinding</code>  在支持外部化配置属性与 Dubbo 配置类绑定时，与 Dubbo 过去的映射行为不同，被绑定的 Dubbo 配置类将会提升为 Spring Bean，无需提前装配 Dubbo 配置类。同时，支持多 Dubbo 配置Bean 装配。其 Bean 的绑定规则与<code class="highlighter-rouge">@EnableDubboConfig</code>一致。</p>

<h4 id="起始版本-258">起始版本： <code class="highlighter-rouge">2.5.8</code></h4>

<h4 id="使用说明-1">使用说明</h4>

<h5 id="enabledubboconfigbinding-定义"><code class="highlighter-rouge">@EnableDubboConfigBinding</code> 定义</h5>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="nd">@interface</span> <span class="n">EnableDubboConfigBinding</span> <span class="o">{</span>

    <span class="cm">/**
     * The name prefix of the properties that are valid to bind to {@link AbstractConfig Dubbo Config}.
     *
     * @return the name prefix of the properties to bind
     */</span>
    <span class="n">String</span> <span class="nf">prefix</span><span class="o">();</span>

    <span class="cm">/**
     * @return The binding type of {@link AbstractConfig Dubbo Config}.
     * @see AbstractConfig
     * @see ApplicationConfig
     * @see ModuleConfig
     * @see RegistryConfig
     */</span>
    <span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">AbstractConfig</span><span class="o">&gt;</span> <span class="nf">type</span><span class="o">();</span>

    <span class="cm">/**
     * It indicates whether {@link #prefix()} binding to multiple Spring Beans.
     *
     * @return the default value is &lt;code&gt;false&lt;/code&gt;
     */</span>
    <span class="kt">boolean</span> <span class="nf">multiple</span><span class="o">()</span> <span class="k">default</span> <span class="kc">false</span><span class="o">;</span>

<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li><code class="highlighter-rouge">prefix()</code> : 指定待绑定 Dubbo 配置类的外部化配置属性的前缀，比如<code class="highlighter-rouge">dubbo.application</code>  为 <code class="highlighter-rouge">ApplicationConfig</code> 的外部化配置属性的前缀。<code class="highlighter-rouge">prefix()</code> 支持占位符（Placeholder）, 并且其关联前缀值是否以”.” 作为结尾字符是可选的，即<code class="highlighter-rouge">prefix() = "dubbo.application"</code> 与 <code class="highlighter-rouge">prefix() = "dubbo.application."</code> 效果相同</li>
  <li><code class="highlighter-rouge">type()</code> : 指定 Dubbo 配置类，所有 <code class="highlighter-rouge">AbstractConfig</code> 的实现子类即可，如<code class="highlighter-rouge">ApplicationConfig</code> 、<code class="highlighter-rouge">RegistryConfig</code> 以及 <code class="highlighter-rouge">ProtocolConfig</code> 等</li>
  <li><code class="highlighter-rouge">multiple()</code> : 表明是否需要将<code class="highlighter-rouge">prefix()</code>   作为多个 <code class="highlighter-rouge">type()</code>   类型的 Spring Bean 外部化配置属性。默认值为<code class="highlighter-rouge">false</code>，即默认支持单个类型的 Spring 配置 Bean</li>
</ul>

<p>假设标注 <code class="highlighter-rouge">@EnableDubboConfigBinding</code> 的实现类被 Spring 应用上下文扫描并且注册后，其中<code class="highlighter-rouge">prefix()</code> =  <code class="highlighter-rouge">dubbo.app</code> 、 <code class="highlighter-rouge">type()</code> = <code class="highlighter-rouge">ApplicationConfig.class</code> ，且外部配置内容为：</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="py">dubbo.app.id</span> <span class="p">=</span> <span class="s">applicationBean</span>
<span class="py">dubbo.app.name</span> <span class="p">=</span> <span class="s">dubbo-demo-application</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Spring 应用上下文启动后，一个 ID 为 “applicationBean”   的 <code class="highlighter-rouge">ApplicationConfig</code>  Bean 被初始化，其 <code class="highlighter-rouge">name</code> 字段被设置为 “dubbo-demo-application”。</p>

<h5 id="enabledubboconfigbindings-定义"><code class="highlighter-rouge">EnableDubboConfigBindings</code> 定义</h5>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="nd">@interface</span> <span class="n">EnableDubboConfigBindings</span> <span class="o">{</span>

    <span class="cm">/**
     * The value of {@link EnableDubboConfigBindings}
     *
     * @return non-null
     */</span>
    <span class="n">EnableDubboConfigBinding</span><span class="o">[]</span> <span class="nf">value</span><span class="o">();</span>

<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li><code class="highlighter-rouge">value</code> : 指定多个<code class="highlighter-rouge">EnableDubboConfigBinding</code>，用于实现外部化配置属性前缀（<code class="highlighter-rouge">prefix</code>) 与 Dubbo 配置 Bean 类型（<code class="highlighter-rouge">AbstractConfig</code> 子类）绑定。</li>
</ul>

<h4 id="示例说明-1">示例说明</h4>

<h5 id="外部化配置文件-2">外部化配置文件</h5>

<p>将以下内容的外部化配置文件物理路径为：<code class="highlighter-rouge">classpath:/META-INF/bindings.properties</code></p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="c"># classpath:/META-INF/bindings.properties
## 占位符值 : ApplicationConfig 外部配置属性前缀
</span><span class="py">applications.prefix</span> <span class="p">=</span> <span class="s">dubbo.apps.</span>

<span class="c">## 多 ApplicationConfig Bean 绑定
</span><span class="py">dubbo.apps.applicationBean.name</span> <span class="p">=</span> <span class="s">dubbo-demo-application</span>
<span class="py">dubbo.apps.applicationBean2.name</span> <span class="p">=</span> <span class="s">dubbo-demo-application2</span>
<span class="py">dubbo.apps.applicationBean3.name</span> <span class="p">=</span> <span class="s">dubbo-demo-application3</span>

<span class="c">## 单 ModuleConfig Bean 绑定
</span><span class="py">dubbo.module.id</span> <span class="p">=</span> <span class="s">moduleBean</span>
<span class="py">dubbo.module.name</span> <span class="p">=</span> <span class="s">dubbo-demo-module</span>

<span class="c">## 单 RegistryConfig Bean 绑定
</span><span class="py">dubbo.registry.address</span> <span class="p">=</span> <span class="s">zookeeper://192.168.99.100:32770</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h5 id="enabledubboconfigbindings-配置-bean"><code class="highlighter-rouge">EnableDubboConfigBindings</code> 配置 Bean</h5>

<p><code class="highlighter-rouge">DubboConfiguration</code> 作为 Dubbo 配置 Bean，除通过 <code class="highlighter-rouge">@EnableDubboConfigBinding</code> 绑定之外，还需要 <code class="highlighter-rouge">@PropertySource</code> 指定外部化配置文件（<code class="highlighter-rouge">classpath:/META-INF/bindings.properties</code>）:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="cm">/**
 * Dubbo 配置 Bean
 *
 * @author &lt;a href="mailto:mercyblitz@gmail.com"&gt;Mercy&lt;/a&gt;
 */</span>
<span class="nd">@EnableDubboConfigBindings</span><span class="o">({</span>
        <span class="nd">@EnableDubboConfigBinding</span><span class="o">(</span><span class="n">prefix</span> <span class="o">=</span> <span class="s">"${applications.prefix}"</span><span class="o">,</span>
                <span class="n">type</span> <span class="o">=</span> <span class="n">ApplicationConfig</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">multiple</span> <span class="o">=</span> <span class="kc">true</span><span class="o">),</span> <span class="c1">// 多 ApplicationConfig Bean 绑定</span>
        <span class="nd">@EnableDubboConfigBinding</span><span class="o">(</span><span class="n">prefix</span> <span class="o">=</span> <span class="s">"dubbo.module"</span><span class="o">,</span> <span class="c1">// 不带 "." 后缀</span>
                <span class="n">type</span> <span class="o">=</span> <span class="n">ModuleConfig</span><span class="o">.</span><span class="na">class</span><span class="o">),</span> <span class="c1">// 单 ModuleConfig Bean 绑定</span>
        <span class="nd">@EnableDubboConfigBinding</span><span class="o">(</span><span class="n">prefix</span> <span class="o">=</span> <span class="s">"dubbo.registry."</span><span class="o">,</span> <span class="c1">// 带 "." 后缀</span>
                <span class="n">type</span> <span class="o">=</span> <span class="n">RegistryConfig</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="c1">// 单 RegistryConfig Bean 绑定</span>
<span class="o">})</span>
<span class="nd">@PropertySource</span><span class="o">(</span><span class="s">"META-INF/bindings.properties"</span><span class="o">)</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DubboConfiguration</span> <span class="o">{</span>
  
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h5 id="实现引导类-2">实现引导类</h5>

<p>通过之前的使用说明，当 <code class="highlighter-rouge">EnableDubboConfigBinding</code> 将外部配置化文件<code class="highlighter-rouge">classpath:/META-INF/dubbo.properties</code> 绑定到 <code class="highlighter-rouge">ApplicationConfig</code>后，其中 Spring Bean “applicationBean” 的 name 字段被设置成 “dubbo-demo-application”。同时， <code class="highlighter-rouge">EnableDubboConfigBinding</code>  所标注的 <code class="highlighter-rouge">DubboConfiguration</code> 需要被 Sring 应用上下文注册：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre><span class="cm">/**
 * Dubbo 配置引导类
 *
 * @author &lt;a href="mailto:mercyblitz@gmail.com"&gt;Mercy&lt;/a&gt;
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DubboConfigurationBootstrap</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 创建配置上下文</span>
        <span class="n">AnnotationConfigApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="o">();</span>
        <span class="c1">// 注册当前配置 Bean</span>
        <span class="n">context</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">DubboConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">context</span><span class="o">.</span><span class="na">refresh</span><span class="o">();</span>
 		<span class="c1">// 获取 ApplicationConfig Bean："applicationBean"、"applicationBean2" 和 "applicationBean3"</span>
        <span class="n">ApplicationConfig</span> <span class="n">applicationBean</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"applicationBean"</span><span class="o">,</span> <span class="n">ApplicationConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">ApplicationConfig</span> <span class="n">applicationBean2</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"applicationBean2"</span><span class="o">,</span> <span class="n">ApplicationConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">ApplicationConfig</span> <span class="n">applicationBean3</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"applicationBean3"</span><span class="o">,</span> <span class="n">ApplicationConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"applicationBean.name = %s \n"</span><span class="o">,</span> <span class="n">applicationBean</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"applicationBean2.name = %s \n"</span><span class="o">,</span> <span class="n">applicationBean2</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"applicationBean3.name = %s \n"</span><span class="o">,</span> <span class="n">applicationBean3</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>

        <span class="c1">// 获取 ModuleConfig Bean："moduleBean"</span>
        <span class="n">ModuleConfig</span> <span class="n">moduleBean</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"moduleBean"</span><span class="o">,</span> <span class="n">ModuleConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"moduleBean.name = %s \n"</span><span class="o">,</span> <span class="n">moduleBean</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>

        <span class="c1">// 获取 RegistryConfig Bean</span>
        <span class="n">RegistryConfig</span> <span class="n">registry</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">RegistryConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"registry.address = %s \n"</span><span class="o">,</span> <span class="n">registry</span><span class="o">.</span><span class="na">getAddress</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h5 id="运行结果">运行结果</h5>

<p><code class="highlighter-rouge">DubboConfigurationBootstrap</code> 运行后控制台输出：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>applicationBean.name = dubbo-demo-application 
applicationBean2.name = dubbo-demo-application2 
applicationBean3.name = dubbo-demo-application3 
moduleBean.name = dubbo-demo-module 
registry.address = zookeeper://192.168.99.100:32770 
</pre></td></tr></tbody></table></code></pre></div></div>

<p>输出的内容与<code class="highlighter-rouge">classpath:/META-INF/bindings.properties</code> 绑定的内容一致，符合期望。</p>
